<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .sidebar{
            overflow-y: auto;
            min-height: 100vh;
        }

    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-2 sidebar">
                <div class="text-center">
                    <a href="\index.html">
                        <img src="images/FinalLogo.png" alt="Logo" class="img-fluid mb-4">
                    </a>
                </div>
                <a href="#" data-toggle="modal" data-target="#addLectureModal">Lectures</a>
                <a href="#" data-toggle="modal" data-target="#requestsModal">Requests</a>
                <a href="#" data-toggle="modal" data-target="#addCourseModal">Courses</a>
                <a href="#" data-toggle="modal" data-target="#addHomeworkModal">Homeworks</a>
                <a href="attendance.html">Attendance</a>

                <a href="#" data-toggle="modal" data-target="#addExamModal">Exams</a>
            </nav>
            <main class="col-md-10 offset-md-2 main-content">
                <div class="header" style="border-radius: 100px;">
                    <div class="admin"><b>Welcome Back, Admin</b></div>
                    <p class="mt-3">What would you like to do today?</p>
                </div>
                <div class="text-center my-4">
                    <button id="sendEmailsButton" class="btn btn-primary">Send Reports to All Parents</button>
                </div>

                <div class="row mt-5 text-center">
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <img src="images/22.png" class="card-img-top icon" alt="Lectures">
                            <div class="card-body">
                                <h5 class="card-title btn btn-customs" data-toggle="modal"
                                    data-target="#addLectureModal">Lectures</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <img src="images/Students-rafiki.png" class="card-img-top icon" alt="Students">
                            <div class="card-body">
                                <h5 class="card-title btn btn-customs" data-toggle="modal" data-target="#requestsModal">
                                    Requests</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <img src="images/Online test-bro.png" class="card-img-top icon" alt="Exams">
                            <div class="card-body">
                                <h5 class="card-title btn btn-customs" data-toggle="modal" data-target="#addExamModal">
                                    Exams</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <img src="images/Course app-pana.png" class="card-img-top icon" alt="Courses">
                            <div class="card-body">
                                <h5 class="card-title btn btn-customs" data-toggle="modal"
                                    data-target="#addCourseModal">
                                    Courses</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>




    <!-- Add Course Modal -->
    <div class="modal fade" id="addCourseModal" tabindex="-1" aria-labelledby="addCourseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCourseModalLabel">Add Course</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addCourseForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="courseName">Course Name</label>
                            <input type="text" class="form-control" id="courseName" name="courseName" required>
                        </div>
                        <div class="form-group">
                            <label for="courseLocation">Location</label>
                            <select class="form-control" id="courseLocation" name="courseLocation" required>
                                <option value="New Cairo">New Cairo</option>
                                <option value="Zahraa al Maadi">Zahraa al Maadi</option>
                                <option value="Online">Online</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="courseImage">Course Image</label>
                            <input type="file" class="form-control-file" id="courseImage" name="courseImage"
                                accept="image/*" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Course</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Lecture Modal -->
    <!-- Add Lecture Modal -->
    <div class="modal fade" id="addLectureModal" tabindex="-1" aria-labelledby="addLectureModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addLectureModalLabel">Add Lecture</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addLectureForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="courseID">Course ID</label>
                            <input type="number" class="form-control" id="courseID" name="courseID" required>
                        </div>
                        <div class="form-group">
                            <label for="lectureTitle">Lecture Title</label>
                            <input type="text" class="form-control" id="lectureTitle" name="lectureTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="lectureFile">Lecture File</label>
                            <input type="file" class="form-control-file" id="lectureFile" name="lectureFile" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Lecture</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Requests Modal -->
    <div class="modal fade" id="requestsModal" tabindex="-1" aria-labelledby="requestsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="requestsModalLabel">Requests</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Full Name</th>
                                <th>user id</th>
                                <th>Email</th>
                                <th>Course ID</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="requestsTableBody">
                            <!-- Requests will be loaded here via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <!-- Add Exam Modal -->
    <div class="modal fade" id="addExamModal" tabindex="-1" aria-labelledby="addExamModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addExamModalLabel">Add Exam</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" enctype="multipart/form-data">
                    <form id="addExamForm">
                        <div class="form-group">
                            <label for="courseID">Course ID</label>
                            <input type="number" class="form-control" id="courseID" name="courseID" required>
                        </div>
                        <div class="form-group">
                            <label for="testTitle">Test Title</label>
                            <input type="text" class="form-control" id="testTitle" name="testTitle" required>
                        </div>
                        <div id="passagesContainer">
                            <!-- Dynamic passages and questions will be inserted here -->
                        </div>
                        <button type="button" class="btn btn-secondary" id="addPassageBtn">Add Passage</button>
                        <button type="submit" class="btn btn-primary">Add Exam</button>
                    </form>
                </div>
            </div>
        </div>
    </div>




    <!-- add homework modal -->

    <div class="modal fade" id="addHomeworkModal" tabindex="-1" aria-labelledby="addHomeworkModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addHomeworkModalLabel">Add Homework</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" enctype="multipart/form-data">
                    <form id="addHomeworkForm">
                        <div class="form-group">
                            <label for="courseID">Course ID</label>
                            <input type="number" class="form-control" id="courseID" name="courseID" required>
                        </div>
                        <div class="form-group">
                            <label for="homeworkTitle">Homework Title</label>
                            <input type="text" class="form-control" id="homeworkTitle" name="homeworkTitle" required>
                        </div>
                        <div id="homeworkPassagesContainer">
                            <!-- Dynamic passages and questions will be inserted here -->
                        </div>
                        <button type="button" class="btn btn-secondary" id="addHomeworkPassageBtn">Add Passage</button>
                        <button type="submit" class="btn btn-primary">Add Homework</button>
                    </form>
                </div>
            </div>
        </div>
    </div>




    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>

    <script>


        document.addEventListener('DOMContentLoaded', function() {

            $('#requestsModal').on('show.bs.modal', function () {
                $.ajax({
                    url: '/get-requests',
                    type: 'GET',
                    success: function (response) {
                        var tbody = $('#requestsTableBody');
                        tbody.empty();
                        response.forEach(function (request) {
                            var row = `<tr>
                                <td>${request.full_name}</td>
                                <td>${request.user_id}</td>
                                <td>${request.email}</td>
                                <td>${request.course_id}</td>
                                <td class="btn-group">
                                    <button class="btn btn-success accept-request mr-3" data-user-id="${request.user_id}" data-email="${request.EMAIL}" data-course-id="${request.course_id}">Accept</button>
                                    <button class="btn btn-danger delete-request" data-user-id="${request.user_id}" data-email="${request.EMAIL}" data-course-id="${request.course_id}">Delete</button>
                                </td>
                            </tr>`;
                            tbody.append(row);
                        });
            
                        $('.accept-request').click(function () {
                            var userId = $(this).data('user-id');
                            var email = $(this).data('email');
                            var courseId = $(this).data('course-id');
                            
                            $.ajax({
                                url: '/accept-request',
                                type: 'POST',
                                data: JSON.stringify({ userId: userId, email: email, course_id: courseId }),
                                contentType: 'application/json',
                                success: function (response) {
                                    alert('Request accepted successfully!');
                                    $('#requestsModal').modal('hide');
                                },
                                error: function (xhr, status, error) {
                                    alert('Error accepting request: ' + error);
                                }
                            });
                        });
                        
            
                        $('.delete-request').click(function () {
                            var userId = $(this).data('user-id');
                            var courseId = $(this).data('course-id');
                        
                            $.ajax({
                                url: '/delete-request',
                                type: 'POST',
                                data: JSON.stringify({ userId: userId, course_id: courseId }),
                                contentType: 'application/json',
                                success: function (response) {
                                    alert('Request deleted successfully!');
                                    $('#requestsModal').modal('hide');
                                    // Optionally, you could also remove the deleted request row from the table here
                                    $(this).closest('tr').remove();
                                },
                                error: function (xhr, status, error) {
                                    alert('Error deleting request: ' + error);
                                }
                            });
                        });
                        
                    },
                    error: function (xhr, status, error) {
                        alert('Error fetching requests: ' + error);
                    }
                });
            });
            
            
            
                    $('#addCourseForm').submit(function (e) {
                        e.preventDefault();
                        var formData = new FormData(this);
            
                        $.ajax({
                            url: '/add-course',
                            type: 'POST',
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function (response) {
                                alert('Course added successfully!');
                                $('#addCourseModal').modal('hide');
                            },
                            error: function (xhr, status, error) {
                                alert('Error adding course: ' + error);
                            }
                        });
                    });
                    
            
            
                    
                    $('#addLectureForm').submit(function (e) {
                        e.preventDefault();
                        var formData = new FormData(this);
                    
                        $.ajax({
                            url: '/add-lecture',
                            type: 'POST',
                            data: formData,
                            contentType: false,
                            processData: false,
                            success: function (response) {
                                alert('Lecture added successfully!');
                                $('#addLectureModal').modal('hide');
                            },
                            error: function (xhr, status, error) {
                                alert('Error adding lecture: ' + error);
                            }
                        });
                    });
            
        
            
            document.getElementById('addPassageBtn').addEventListener('click', function() {
                const passageContainer = document.createElement('div');
                passageContainer.classList.add('passage-container');
                passageContainer.innerHTML = `
                    <div class="form-group">
                        <label for="passageContent">Passage Content</label>
                        <textarea class="form-control" name="passageContent[]" required></textarea>
                    </div>
                    <div class="questionsContainer">
                        <!-- Questions will be added here -->
                    </div>
                    <button type="button" class="btn btn-secondary addQuestionBtn">Add Question</button>
                    <hr/>
                `;
                document.getElementById('passagesContainer').appendChild(passageContainer);
            
                const addQuestionBtn = passageContainer.querySelector('.addQuestionBtn');
                addQuestionBtn.addEventListener('click', function() {
                    const questionsContainer = passageContainer.querySelector('.questionsContainer');
                    const questionContainer = document.createElement('div');
                    questionContainer.classList.add('question-container');
                    questionContainer.innerHTML = `
                        <div class="form-group">
                            <label for="questionText">Question Text</label>
                            <input type="text" class="form-control" name="questionText[]" required>
                        </div>
                        <div class="form-group">
                            <label>Options</label>
                            <input type="text" class="form-control mb-3" name="optionA[]" placeholder="Option A" required>
                            <input type="text" class="form-control mb-3" name="optionB[]" placeholder="Option B" required>
                            <input type="text" class="form-control mb-3" name="optionC[]" placeholder="Option C" required>
                            <input type="text" class="form-control mb-3" name="optionD[]" placeholder="Option D" required>
                        </div>
                        <div class="form-group">
                            <label for="correctOption">Correct Option</label>
                            <select class="form-control" name="correctOption[]" required>
                                <option value="a">A</option>
                                <option value="b">B</option>
                                <option value="c">C</option>
                                <option value="d">D</option>
                            </select>
                        </div>
                        <hr/>
                    `;
                    questionsContainer.appendChild(questionContainer);
                });
            });
            document.getElementById('addExamForm').addEventListener('submit', function(event) {
                event.preventDefault();
            
                const formData = new FormData(this);
             
                fetch('/add-exam', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        alert(data.message);
                    } else {
                        alert('Error adding exam: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred: ' + error.message);
                });
            });
            //
             
            
            document.getElementById('sendEmailsButton').addEventListener('click', function() {
                if (confirm('Are you sure you want to send reports to all parents?')) {
                  fetch('/send-all-parents-messages', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json'
                    }
                  })
                  .then(response => response.json())
                  .then(data => {
                    if (data.success) {
                      alert('Emails and WhatsApp messages sent successfully!');
                    } else {
                      alert('Error sending messages: ' + data.error);
                    }
                  })
                  .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred: ' + error.message);
                  });
                }
              });


              document.getElementById('addHomeworkPassageBtn').addEventListener('click', function() {
                const passageContainer = document.createElement('div');
                passageContainer.classList.add('passage-container');
                passageContainer.innerHTML = `
                    <div class="form-group">
                        <label for="passageContent">Passage Content</label>
                        <textarea class="form-control" name="passageContent[]" required></textarea>
                    </div>
                    <div class="questionsContainer">
                        <!-- Questions will be added here -->
                    </div>
                    <button type="button" class="btn btn-secondary addHomeworkQuestionBtn">Add Question</button>
                    <hr/>
                `;
                document.getElementById('homeworkPassagesContainer').appendChild(passageContainer);
        
                const addHomeworkQuestionBtn = passageContainer.querySelector('.addHomeworkQuestionBtn');
                addHomeworkQuestionBtn.addEventListener('click', function() {
                    const questionsContainer = passageContainer.querySelector('.questionsContainer');
                    const questionContainer = document.createElement('div');
                    questionContainer.classList.add('question-container');
                    questionContainer.innerHTML = `
                        <div class="form-group">
                            <label for="questionText">Question Text</label>
                            <input type="text" class="form-control" name="questionText[]" required>
                        </div>
                        <div class="form-group">
                            <label>Options</label>
                            <input type="text" class="form-control mb-3" name="optionA[]" placeholder="Option A" required>
                            <input type="text" class="form-control mb-3" name="optionB[]" placeholder="Option B" required>
                            <input type="text" class="form-control mb-3" name="optionC[]" placeholder="Option C" required>
                            <input type="text" class="form-control mb-3" name="optionD[]" placeholder="Option D" required>
                        </div>
                        <div class="form-group">
                            <label for="correctOption">Correct Option</label>
                            <select class="form-control" name="correctOption[]" required>
                                <option value="a">A</option>
                                <option value="b">B</option>
                                <option value="c">C</option>
                                <option value="d">D</option>
                            </select>
                        </div>
                        <hr/>
                    `;
                    questionsContainer.appendChild(questionContainer);
                });
            });
        
            document.getElementById('addHomeworkForm').addEventListener('submit', function(event) {
                event.preventDefault();
        
                const formData = new FormData(this);
        
                fetch('/add-homework', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        alert(data.message);
                    } else {
                        alert('Error adding homework: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred: ' + error.message);
                });
            });
         
        });
        
        
        
        
        
     
        
    </script>
</body>

</html>